# Fun√ß√µes `LAG`, `LEAD` e C√°lculo de MoM (Month over Month)

## Fun√ß√µes `LAG` e `LEAD`

As fun√ß√µes `LAG` e `LEAD` permitem acessar valores de linhas anteriores ou posteriores dentro de um conjunto de resultados.

- **`LAG`**: Retorna o valor de uma linha anterior em rela√ß√£o √† linha atual.
- **`LEAD`**: Retorna o valor de uma linha posterior em rela√ß√£o √† linha atual.

### Sintaxe

```sql
LAG(column_name, offset, default_value) OVER (PARTITION BY column_to_partition ORDER BY column_to_order)

LEAD(column_name, offset, default_value) OVER (PARTITION BY column_to_partition ORDER BY column_to_order)
```

- `column_name`: Coluna que voc√™ deseja acessar.
- `offset`: Quantidade de linhas para olhar para tr√°s (`LAG`) ou para frente (`LEAD`). Padr√£o √© 1.
- `default_value`: Valor retornado se n√£o houver linha anterior/posterior.

### Exemplo `LAG`

```sql
SELECT
  cliente_id,
  data_compra,
  valor_compra,
  LAG(valor_compra) OVER (PARTITION BY cliente_id ORDER BY data_compra) AS compra_anterior
FROM vendas;
```

### Exemplo `LEAD`

```sql
SELECT
  cliente_id,
  data_compra,
  valor_compra,
  LEAD(valor_compra) OVER (PARTITION BY cliente_id ORDER BY data_compra) AS proxima_compra
FROM vendas;
```

## C√°lculo de MoM (Month over Month)

O MoM √© utilizado para medir a varia√ß√£o percentual entre o valor de um m√™s e o valor do m√™s anterior.

### Exemplo de C√°lculo de MoM usando `LAG`

```sql
SELECT
  EXTRACT(YEAR FROM data_venda) AS ano,
  EXTRACT(MONTH FROM data_venda) AS mes,
  SUM(valor_venda) AS total_vendas,
  LAG(SUM(valor_venda)) OVER (ORDER BY EXTRACT(YEAR FROM data_venda), EXTRACT(MONTH FROM data_venda)) AS vendas_mes_anterior,
  CASE WHEN LAG(SUM(valor_venda)) OVER (ORDER BY EXTRACT(YEAR FROM data_venda), EXTRACT(MONTH FROM data_venda)) IS NOT NULL
    THEN ROUND((SUM(valor_venda) - LAG(SUM(valor_venda)) OVER (ORDER BY EXTRACT(YEAR FROM data_venda), EXTRACT(MONTH FROM data_venda))) / LAG(SUM(valor_venda)) OVER (ORDER BY EXTRACT(YEAR FROM data_venda), EXTRACT(MONTH FROM data_venda)) * 100, 2)
  ELSE NULL
  END AS mom_percentual
FROM vendas
GROUP BY EXTRACT(YEAR FROM data_venda), EXTRACT(MONTH FROM data_venda)
ORDER BY ano, mes;
```

### Explica√ß√£o
- **`LAG(SUM(valor_venda))`**: Recupera o valor total de vendas do m√™s anterior.
- **MoM Percentual**: Calcula a diferen√ßa entre o m√™s atual e o anterior e divide pelo m√™s anterior, multiplicando por 100 para obter o percentual.

---

Se quiser, podemos montar tamb√©m exemplos de MoM j√° pensando em agrupamentos como "por filial" ou "por produto"! üöÄ

